{{extend 'layout.html'}}

<div class="row mb-5">
	<!-- Left column with images -->
	<div class="col-6">
		<div class="swiper-window">
			<div class="swiper-wrapper" style="translate: 0px;">
				{{for image in images:
				img_src = image['image_filename']
				img_alt = image['image_alt']
				}}
				<div class="swiper-item"><img src={{=URL(f'static/images/{cat}/{brand}', img_src)}} alt={{=img_alt}}>
				</div>
				{{pass}}
			</div>
		</div>
		<div class="product-view-bar">
			{{
			for count, image in enumerate(images):
			img_src = image['image_filename']
			img_alt = image['image_alt']
			}}
			<div class="thumbnail" data-count={{=count}}><img src={{=URL(f'static/images/{cat}/{brand}', img_src)}}
					alt={{=img_alt}}></div>
			{{pass}}
		</div>
	</div>
	<!-- Right column with info -->
	<div class="col-6">
		<h2 class="font-weight-bold mb-4">{{=product['product_name']}}</h2>
		<h3 class="mb-5">${{=product['price']}}</h3>
		<h5 class="border-bottom p-1">Key Features</h5>
		<ul class="mb-5">
			{{
            features = db((db.product_attribute.product_id == product_id)).select()

            for i in features:
				desc = db(db.attribute_description.id == i.attribute_id).select().first()
			}}
		
				<li><i>{{=desc.longhand}}</i>: {{=i.attribute_value}}</li>
				{{pass}}
				{{pass}}

			{{pass}}
		</ul>
		<form id="add-to-cart">
			<input type="hidden" value="{{=product.id}}" name="product_id" id="product_id">
			{{if auth.user:}}
			<input type="hidden" value="{{=auth.user.id}}" name="user_id" id="user_id">
			{{else:}}
			<span>User not logged in</span>
			{{pass}}
			<input type="hidden" value="{{=response.session_id}}" name="session_id" id="session_id">
			<div class="d-flex align-items-center justify-content-between w-100 flex-gap-4">
				<div class="d-flex align-items">
					<label for="quantity" class="mr-2 mb-0"><span class="align-middle">QTY.</span></label>
					<input type="number" value="1" name="quantity" id="quantity" size="2" class="">
				</div>
				<div class="flex-fill">
					<button type="submit" class="btn btn-mise-accent w-100">
						<i class="fa fa-plus mr-1" aria-hidden="true"></i>
						Add To Cart 
 					</button>
				</div>
			</div>
		</form>
	</div>
</div>
<hr>
<div class="row">
	<div class="col-12">
		<h5>Product Description</h5>
		<p>{{=XML(product['description'])}}</p>
	</div>
</div>

{{block page_js}}
<script>
	jQuery('#add-to-cart').submit(function () {
		ajax('{{=URL('add_to_cart')}}',
			['product_id', 'quantity', 'user_id', 'session_id'], 'target');
		return false;
	});
</script>

<script src={{=URL('static','js/mise_slider.js')}}></script>
{{end page_js}}
