{{extend 'layout.html'}}
<section id='filter_sort' class='px-4 d-flex flex-wrap'>
    <form id="filter_form" class="d-flex w-100 h-100" method=GET>
        <ul class="d-flex flex-wrap text-primary list-unstyled">
{{
    for key, value in options.items():
}}
            <li class=" dropdown mr-3">
                <p class="dropdown-toggle btn btn-primary btn-sm {{if len(key)>6:}}w-120px{{else:}}w-100px{{pass}} color-secondary" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{=key}}</p>
                <fieldset id='{{=key}}' class="dropdown-menu border">
                {{for attr_value in value:}}
                 <input class='ml-3' type="checkbox" name="{{=key}}[]" value="{{=attr_value}}" {{if key in filter_dict and attr_value in filter_dict[key]:}}checked{{pass}}> {{=attr_value}}<br>
                {{pass}}
                </fieldset>
            </li>
{{pass}}
            <li class="dropdown mr-3">
                <p class="dropdown-toggle btn btn-primary btn-sm w-100px color-secondary" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Price</p>
                <fieldset id='Screen_Size' class="dropdown-menu">
                <input class='ml-3' type="radio" name="Price[]" value="0--499" {{if request.vars['Price[]'] == '0---499':}}checked{{pass}}> under $500<br>
                <input class='ml-3' type="radio" name="Price[]" value="500--1000" {{if request.vars['Price[]'] == '500--1000':}}checked{{pass}}> $500 - $1000<br>
                <input class='ml-3' type="radio" name="Price[]" value="1000--100000000" {{if request.vars['Price[]'] == '1000--100000000':}}checked{{pass}}> $1000+<br>
            </fieldset>
            </li>
            <li><input id="apply-btn" class="btn btn-sm w-100px" type="submit" value="Apply"></li>
            <li><input id="clear-btn" class="bg-transparent text-muted btn-sm td-ul f-8rem ml-1 pt-2" type="submit" value="clear all"></li>
        </ul>
        <ul class=" w-25 d-flex justify-content-end list-unstyled h-100 ml-auto">
            <li class="dropdown w-75 d-flex justify-content-end">
            <p class="dropdown-toggle btn btn-primary btn-sm w-75 color-secondary" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Sort By:</p>
            <fieldset class="dropdown-menu dropdown-menu-right w-100">
            <input id="sort-default" class='' type="radio" name="ORDER" value="default" hidden checked>
            <label for="sort-default" class='dropdown-item'>Default</label>

            <input id="price-asc" class='' type="radio" name="ORDER" value="price-asc" hidden {{if request.vars.ORDER == 'price-asc':}}checked{{pass}}>
            <label for="price-asc" class='dropdown-item'>Price Low to High</label>

            <input id="price-desc" class='' type="radio" name="ORDER" value="price-desc" hidden {{if request.vars.ORDER == 'price-desc':}}checked{{pass}}>
            <label for="price-desc" class='dropdown-item'>Price High to Low</label>
            </fieldset>
            </li>
        </ul>
    </form>
    <!-- <p class='small text-muted td-ul mtneg-1rem'>{#{#=f"{len(products)} {link_arg[1]} found"}}</p> -->
</section>

    <script>
    "use strict"

    const filter_form = document.getElementById("filter_form");
    const sortRadios = document.querySelectorAll('input[name="ORDER"]');

    window.onload = function() {
        document.getElementById("apply-btn").onclick = applyFilters;
        document.getElementById("clear-btn").onclick = clearFilters;

        sortRadios.forEach(radio => {
          radio.addEventListener('change', () => {
          const ORDER = filter_form.querySelector('input[name="ORDER"]:checked');
          filter_form.submit();});
        });}


    function applyFilters() {
        filter_form.submit();}

    function clearFilters() {
        filter_form.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = false);
        filter_form.querySelectorAll('input[type="radio"]').forEach(el => {if (el.name !== 'ORDER') {el.checked = false;}});}
    </script>


	<hr>

<div class="row">
	<h2 class="mb-4 text-accent">{{=cat_name_fix}}</h2>
</div>

<div class="row product-row flex-gap-2">
    {{for row in products:
        name = row['product_name']
        name_link = name.replace(" ", "-")
        price = row['price']
        key_features = row['key_features']
        product_id = row['id']
        img_src = row['image_filename']
        img_alt = row['image_alt']}}

    
	<div class="col product">
		{{=IMG(_src=URL('static/images/test_products', img_src), _alt=img_alt)}}
		<h4 class="mt-3">
			<a href="{{=URL('item_page', args=(str(product_id) + '--' + name_link))}}"data-product-id={{=product_id}}>{{=name}}</a>
		</h4>
	
		<ul>
			{{
			features = key_features[1:-1].split("|")
			for feature in features:
			=LI(*feature)
			}}
			{{pass}}
		</ul>

		<div class="price-info">
			<p class="block">${{=f"{price:.2f}"}}</p>
		</div>

	</div>
    {{pass}}

<!-- add extra div boxes to fill up empty space to create a nice grid -->
        {{row_count = 3
        if (len(products) % row_count):
            extras =  row_count - (len(products) % row_count)}}
            {{for i in range(extras):}}
            <div class="product empty"></div>
            {{pass}}
        {{pass}}

    </div>


{{block page_js}}
<script>
    "use strict"

    window.onload = function () {
        document.getElementById("apply-btn").onclick = applyFilters;
        document.getElementById("clear-btn").onclick = clearFilters;

        const filter_form = document.getElementById("filter_form");
        const sortRadios = document.querySelectorAll('input[name="ORDER"]');

        sortRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                const ORDER = filter_form.querySelector('input[name="ORDER"]:checked');
                filter_form.submit();
            });
        });
    }


    function applyFilters() {
        filter_form.submit();
    }

    function clearFilters() {
        filter_form = document.getElementById("filter_form");
        // clear all checked 
        filter_form.reset();
    }
</script>
{{end page_js}}
